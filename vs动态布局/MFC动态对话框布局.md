
MFC动态对话框布局

https://devblogs.microsoft.com/cppblog/mfc-dynamic-dialog-layout/
头像
2015年4月29日

其中的频繁请求MFC功能（顺便说一句，感谢您的反馈意见，并保持它的到来！）是能够智能地调整大小的对话框，并在运行时他们的内容。

一种方法是拦截父对话框的WM_SIZE消息，并相应地重新计算子控件的大小和位置。它可以工作，但极容易出错-想象一下对应用程序中每个对话框中的每个控件执行此操作。它还在应用程序的表示层中引入了非平凡的逻辑，从而使维护工作日后头痛。

在Visual Studio 2015 RC中，我们引入了一种一致的方法来在运行时管理对话框的布局–我们将其称为“动态对话框布局”。

让我们从一个显示此功能的示例开始。想象一个只有一个按钮的对话框（不用担心，我将很快介绍更实际的示例）：



如果我们将此对话框调整为可调整大小，则用户将能够拉伸窗口，结果如下所示：



这根本没有用。为了使调整大小有意义，我们需要为该按钮找到一个更好的位置，也许还要调整其大小。一种简单而明智的方法是让按钮“粘”在对话框的右下角。换句话说，由于父窗口在水平方向上按X个对话框单位调整大小，在垂直方向上按Y个单位调整大小，我们希望按钮向右和向下移动相同的数量。

让我们继续实施。在资源编辑器中打开“属性”窗口，然后在对话框中单击“确定”按钮。您将看到一个名为“动态布局”的新属性集：



现在将“ Moving Type”更改为“ Both”，并将“ Moving X”和“ Moving Y”设置为100（请记住，我们希望按钮在主机对话框调整大小时向右和向下移动）：



我们暂时不会更改“大小调整类型”，我将在稍后讨论。

现在保存并重新编译。运行应用程序并拉伸对话框。瞧：



这有用得多，不是吗？

让我们更现实一点，并添加另一个按钮“取消”：



现在，我们需要确定调整主机对话框大小时按钮的行为。最简单的方法是让“确定”按钮粘在左下角，让“取消”按钮粘在右下角。我们将“确定”的“动态布局”设置为“移动类型=垂直”，“移动Y = 100”。“取消”按钮将具有“垂直，100、100”（就像上一个示例中的“确定”按钮一样）。

保存，编译，运行和调整大小：



还不错吧？

现在，让我们尝试“ Sizing Type”属性。在下一个示例中，我希望我的按钮与对话框的大小成比例缩放。我们将在此处进行一些数学运算，因此为了简化起见，我创建了一个新对话框，大小为200×100对话框单位。每个按钮的宽度将设置为80个单位（此示例中的高度无关紧要）。

我希望按钮随对话框一起增大和缩小，并始终保持原始比例-这是对话框宽度的80/200或40％。另外，我想在每个按钮和对话框的边缘之间保持恒定的间距，我们称其为Δ：



如何使用“动态布局”设置来表达这一点？

让我们从“确定”按钮开始。就其运动而言，它将继续垂直垂直移动100％，因此它始终固定在底部边缘。我还希望它随着主机对话框的大小动态调整大小。该按钮占据对话框宽度的40％，这意味着父对话框的宽度每次增加100个单位时，我希望“确定”按钮增加40个单位。这是使用“动态布局”属性来表达它的方法：



“取消”按钮需要做更多的工作。随着父对话框的增长，此按钮将水平和垂直移动。垂直移动很容易–我希望按钮贴在底部边缘，所以100％。接下来，我将复制“确定”按钮中的“尺寸调整X”属性–这很有意义，两个按钮应保持相同的增长率，这样无论尺寸大小，它们将始终具有相同的尺寸主机对话框。

现在，让我们计算“ Moving X”属性。我说过我们会在这里做一些数学运算，所以去吧。当对话框的宽度从200增加到300时增加100个单位时，每个对话框的宽度也相应增加，即80 * 300/200 =120。“取消”按钮的原始X位置为200-Δ-80= 120-Δ。对话框的宽度增加100个单位后，“取消”按钮的新X位置将为300-Δ-120= 180-Δ。

到目前为止和我在一起？好。正如我们刚刚确定的那样，“取消”按钮的位置从120-Δ移动到180-Δ，即移动60个单位。这就是我们的答案– X位置增长对话框宽度增长的60％。

还有其他计算方法，有时您需要一块餐巾纸或一个信封背面（尤其是对于多个控件作为一个组的复杂布局）。我开发的一个有用的思维模型是询问“对话框的宽度（高度）是否增加100个单位，我应该将控件增加或移动多少？”

这是“取消”按钮的完整动态布局属性集：



这是我们调整后的对话框的全部美感：



诚然，调整按钮的大小不是很有趣-确实使按钮更易于用鼠标敲打，仅此而已。调整大小对于具有非平凡内容的控件（例如列表框，树控件等）非常有用。

为了使它更加有用，我将在对话框中添加一个列表框：



我保持按钮属性不变。列表框将随主机对话框水平和垂直增长，并保持附加在左上角（即不移动）：



这是调整大小的对话框：



我在此描述的所有功能当然都可以通过编程方式获得-动态对话框布局API已添加到MFC。此外，尤其是如果您不是鼠标单击开发人员，则可以直接在RC文件中编辑“动态对话框布局”属性。当然，我们将在MSDN上对此进行记录，并且为了简短起见，在此不再赘述。

与往常一样，我们对您的评论感兴趣。此功能仍然有些粗糙，因此您的及时反馈将使我们能够解决RTM版本中的所有遗漏。

这篇文章中使用的示例应用程序附在下面。

MFC_Dynamic_Dialog_Layout_Demo.zip
